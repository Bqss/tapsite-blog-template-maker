<!-- Breadcrumb -->
<div class="bg-gray-50 py-4">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <nav class="flex items-center space-x-2 text-sm text-gray-600">
      <a href="/home" class="hover:text-blue-600">Home</a>
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
      </svg>
      <a href="/tags" class="hover:text-blue-600">Tags</a>
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
      </svg>
      <span class="text-gray-900">Adventure</span>
    </nav>
  </div>
</div>

<!-- Tag Hero -->
<section class="bg-gradient-to-r from-orange-500 via-red-500 to-pink-500 text-white py-16">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
    <div class="text-6xl mb-4" id="tag-icon">🏷️</div>
    <h1 class="text-4xl md:text-5xl font-bold mb-4" id="tag-title"></h1>
    <p class="text-xl opacity-90 mb-6">Thrilling experiences, extreme sports, and adrenaline-pumping activities around
      the world</p>
    <div class="flex justify-center space-x-8 text-sm">
      <div>
        <div class="text-2xl font-bold" id="stat-articles">...</div>
        <div class="opacity-80">Articles</div>
      </div>
    </div>
  </div>
</section>

<!-- Related Tags -->
<section class="bg-white py-8 border-b">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <h2 class="text-lg font-semibold text-gray-900 mb-4 text-center">Related Tags</h2>
    <div id="related-tags" class="flex flex-wrap gap-3 justify-center">
      <a href="/tag/trekking"
        class="bg-orange-100 text-orange-800 px-4 py-2 rounded-full text-sm font-medium hover:bg-orange-200 transition-colors">🥾
        Trekking</a>
      <a href="/tag/rock-climbing"
        class="bg-gray-100 text-gray-800 px-4 py-2 rounded-full text-sm font-medium hover:bg-gray-200 transition-colors">🧗‍♀️
        Rock Climbing</a>
      <a href="/tag/water-sports"
        class="bg-blue-100 text-blue-800 px-4 py-2 rounded-full text-sm font-medium hover:bg-blue-200 transition-colors">🏄‍♂️
        Water Sports</a>
      <a href="/tag/extreme-sports"
        class="bg-red-100 text-red-800 px-4 py-2 rounded-full text-sm font-medium hover:bg-red-200 transition-colors">🪂
        Extreme Sports</a>
      <a href="/tag/mountain-climbing"
        class="bg-purple-100 text-purple-800 px-4 py-2 rounded-full text-sm font-medium hover:bg-purple-200 transition-colors">⛰️
        Mountain Climbing</a>
      <a href="/tag/wildlife-safari"
        class="bg-green-100 text-green-800 px-4 py-2 rounded-full text-sm font-medium hover:bg-green-200 transition-colors">🦁
        Wildlife Safari</a>
      <a href="/tag/cycling"
        class="bg-yellow-100 text-yellow-800 px-4 py-2 rounded-full text-sm font-medium hover:bg-yellow-200 transition-colors">🚴‍♂️
        Cycling</a>
      <a href="/tag/photography"
        class="bg-indigo-100 text-indigo-800 px-4 py-2 rounded-full text-sm font-medium hover:bg-indigo-200 transition-colors">📸
        Photography</a>
    </div>
  </div>
</section>

<!-- Featured Article -->
<section class="py-12 bg-gray-50"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8" id="tag-featured"></div></section>

<!-- Adventure Articles Grid -->
<main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
  <div class="flex justify-between items-center mb-8">
    <h2 class="text-3xl font-bold text-gray-900">Adventure Travel Stories</h2>
    <select class="border border-gray-300 rounded-lg px-4 py-2 bg-white">
      <option>Sort by Latest</option>
      <option>Sort by Difficulty</option>
      <option>Sort by Adventure Type</option>
      <option>Sort by Popularity</option>
    </select>
  </div>

  <!-- Dynamic grid states -->
  <div id="tag-loading" class="flex justify-center py-12">
    <div class="inline-block animate-spin rounded-full h-10 w-10 border-b-2 border-orange-600"></div>
  </div>
  <div id="tag-error" class="text-center py-12 hidden"><p class="text-red-500">Failed to load stories.</p></div>
  <div id="tag-empty" class="text-center py-12 hidden"><p class="text-gray-500">No stories found.</p></div>
  <div id="tag-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 hidden"></div>

  <!-- Pagination -->
  <div class="flex justify-center mt-12">
    <nav id="tag-pagination" class="flex items-center space-x-2 hidden"></nav>
  </div>
</main>

<!-- Adventure Facts Section -->
<section class="bg-gradient-to-r from-orange-600 via-red-600 to-pink-600 text-white py-16">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
    <h2 class="text-3xl font-bold mb-8">Adventure Travel Facts</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
      <div class="bg-white/10 backdrop-blur-sm rounded-lg p-6">
        <div class="text-3xl mb-3">🌍</div>
        <h3 class="text-xl font-bold mb-2">195 Countries</h3>
        <p class="opacity-90">Adventure opportunities exist in every corner of the world, from Arctic expeditions to
          tropical adventures.</p>
      </div>
      <div class="bg-white/10 backdrop-blur-sm rounded-lg p-6">
        <div class="text-3xl mb-3">🎯</div>
        <h3 class="text-xl font-bold mb-2">Every Skill Level</h3>
        <p class="opacity-90">From beginner-friendly hikes to expert-level mountaineering, there's an adventure for
          everyone.</p>
      </div>
      <div class="bg-white/10 backdrop-blur-sm rounded-lg p-6">
        <div class="text-3xl mb-3">💪</div>
        <h3 class="text-xl font-bold mb-2">Life-Changing</h3>
        <p class="opacity-90">Adventure travel builds confidence, creates memories, and connects you with nature and
          cultures.</p>
      </div>
    </div>
  </div>
</section>

<script>
(function(){
  const LIMIT=9;let currentPage=1,totalPages=1;
  const slug=decodeURIComponent(window.location.pathname.split('/').pop());
  const loadEl=document.getElementById('tag-loading');
  const errEl=document.getElementById('tag-error');
  const emptyEl=document.getElementById('tag-empty');
  const gridEl=document.getElementById('tag-grid');
  const pagEl=document.getElementById('tag-pagination');
  const relatedEl=document.getElementById('related-tags');
  const featuredContainer=document.getElementById('tag-featured');
  const statArticles=document.getElementById('stat-articles');
  const titleEl=document.getElementById('tag-title');
  const iconEl=document.getElementById('tag-icon');

  const fallbackImg="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200' viewBox='0 0 400 200'%3E%3Crect width='400' height='200' fill='%23f3f4f6'/%3E%3Ctext x='200' y='100' text-anchor='middle' dy='0.3em' font-family='Arial' font-size='16' fill='%23666'%3ENo Image%3C/text%3E%3C/svg%3E";

  function tagLink(name){
    return `<a href="/tag/${encodeURIComponent(name)}" class="bg-orange-100 text-orange-800 px-4 py-2 rounded-full text-sm font-medium hover:bg-orange-200 transition-colors">#${name}</a>`;
  }

  async function loadRelated(){
    if(!relatedEl) return;
    try{
      const res=await fetch(`/api/blog/tags/related/${encodeURIComponent(slug)}`);
      if(!res.ok) throw new Error();
      const tags=await res.json();
      if(Array.isArray(tags) && tags.length) relatedEl.innerHTML=tags.map(tagLink).join('');
    }catch(e){console.error(e);}
  }

  function card(p){
    const img=p.featured_image||fallbackImg;
    return `<article class='bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-shadow'>\n      <div class='relative'>\n        <img src='${img}' alt='${p.title}' class='w-full h-48 object-cover'>\n        ${p.tag_badge||p.category?`<div class='absolute top-4 left-4'><span class='bg-orange-500 text-white px-3 py-1 rounded-full text-sm font-medium'>${p.tag_badge||p.category}</span></div>`:''}\n        ${p.difficulty?`<div class='absolute top-4 right-4'><span class='bg-yellow-500 text-white px-2 py-1 rounded text-sm font-medium'>${p.difficulty}</span></div>`:''}\n      </div>\n      <div class='p-6'>\n        <h3 class='text-xl font-bold text-gray-900 mb-2 line-clamp-2'>${p.title}</h3>\n        <p class='text-gray-600 mb-4 line-clamp-3'>${p.excerpt||''}</p>\n        <div class='flex items-center justify-between'>\n          <div class='flex items-center space-x-2'>\n            <img src='${p.author_avatar||"/images/default-avatar.png"}' class='w-8 h-8 rounded-full' alt='${p.author}'>\n            <span class='text-sm text-gray-700'>${p.author||''}</span>\n          </div>\n          <a href='/post/${p.slug}' class='text-orange-600 hover:text-orange-700 font-medium'>Read More →</a>\n        </div>\n      </div>\n    </article>`;
  }

  function buildPagination(){
    if(totalPages<=1){pagEl.classList.add('hidden');return;}
    let html=`<button ${currentPage===1?'disabled':''} data-page='prev' class='px-3 py-2 text-gray-500 hover:text-orange-600 disabled:opacity-40'>&laquo;</button>`;
    for(let i=1;i<=totalPages;i++){
      html+=`<button data-page='${i}' class='px-4 py-2 ${i===currentPage?'bg-orange-600 text-white':'text-gray-700 hover:bg-gray-100'} rounded-lg'>${i}</button>`;
    }
    html+=`<button ${currentPage===totalPages?'disabled':''} data-page='next' class='px-3 py-2 text-gray-500 hover:text-orange-600 disabled:opacity-40'>&raquo;</button>`;
    pagEl.innerHTML=html;
    pagEl.classList.remove('hidden');
    pagEl.querySelectorAll('button').forEach(b=>b.addEventListener('click',e=>{
      const v=e.currentTarget.dataset.page;
      if(v==='prev') load(currentPage-1);
      else if(v==='next') load(currentPage+1);
      else load(parseInt(v));
    }));
  }

  async function load(page=1){
    currentPage=page;
    loadEl.classList.remove('hidden');
    errEl.classList.add('hidden');
    emptyEl.classList.add('hidden');
    gridEl.classList.add('hidden');
    
    try{
      const res=await fetch(`/api/blog/posts/tag/${encodeURIComponent(slug)}?limit=${LIMIT}&page=${page}`);
      if(!res.ok) throw new Error();
      const data=await res.json();
      const posts=data||[];
      document.getElementById('stat-articles').textContent=posts.length;
      totalPages=data.pagination?data.pagination.total_pages:1;
      if(!posts.length){
        emptyEl.classList.remove('hidden');
        buildPagination();
        return;
      }
      gridEl.innerHTML=posts.map(card).join('');
      gridEl.classList.remove('hidden');
      buildPagination();
    }catch(e){console.error(e);errEl.classList.remove('hidden');}
    finally{loadEl.classList.add('hidden');}
  }

  function featuredMarkup(p){return `<h2 class='text-3xl font-bold text-gray-900 mb-8 text-center'>Featured ${p.category||''} Story</h2><div class='bg-white rounded-2xl shadow-lg overflow-hidden md:flex'><div class='md:w-1/2'><img src='${p.featured_image||'/placeholder.png'}' class='w-full h-64 md:h-full object-cover'></div><div class='md:w-1/2 p-8'><h3 class='text-2xl font-bold text-gray-900 mb-4'>${p.title}</h3><p class='text-gray-600 mb-6 line-clamp-4'>${p.excerpt||''}</p><a href='/post/${p.slug}' class='inline-flex items-center bg-orange-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-orange-700 transition-colors'>Read Story →</a></div></div>`;}
  async function loadPosts(){try{const tag=getTag();titleEl.textContent=tag;tagNameEl.textContent=tag;const res=await fetch(`/api/blog/posts/tag/${encodeURIComponent(tag)}?limit=50`);if(!res.ok) throw new Error();let posts=await res.json();if(statArticles) statArticles.textContent=posts.length; if(posts.length){featuredContainer.innerHTML=featuredMarkup(posts[0]);posts=posts.slice(1);}else{featuredContainer.innerHTML='';}
    countEl.textContent=`${posts.length} tutorials found`;grid.innerHTML=posts.length?posts.map(card).join(''):`<div class='text-center py-12 text-gray-400'>No tutorials.</div>`;grid.classList.remove('hidden');}catch(e){console.error(e);errEl.classList.remove('hidden');}finally{loadEl.classList.add('hidden');}}

  document.addEventListener('DOMContentLoaded',()=>{gridEl.innerHTML='';loadRelated();load();});
})();
</script>
