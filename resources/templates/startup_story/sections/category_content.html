<!-- Category Header -->
<header class="bg-gradient-to-r from-blue-600 to-purple-600 text-white py-16">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
    <div class="flex justify-center items-center gap-3 mb-6">
      <div class="bg-white/20 backdrop-blur-sm p-3 rounded-full">
        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5m6-5v6a2 2 0 01-2 2H9a2 2 0 01-2-2v-6m8 0V9a2 2 0 00-2-2H9a2 2 0 00-2 2v4.01">
          </path>
        </svg>
      </div>
      <h1 class="text-4xl font-bold"><span data-category-name></span> Success Stories</h1>
    </div>
    <p class="text-xl text-blue-100 mb-8 max-w-3xl mx-auto">Discover how entrepreneurs built billion-dollar online
      retail empires and revolutionized the way we shop</p>
    <div class="flex justify-center gap-8 text-center">
      <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4">
        <div class="text-2xl font-bold">24</div>
        <div class="text-sm text-blue-100">Success Stories</div>
      </div>
      <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4">
        <div class="text-2xl font-bold">$2.5B</div>
        <div class="text-sm text-blue-100">Avg Valuation</div>
      </div>
      <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4">
        <div class="text-2xl font-bold">78%</div>
        <div class="text-sm text-blue-100">Success Rate</div>
      </div>
    </div>
  </div>
</header>

<!-- Subcategory Filters -->
<div class="bg-gray-50 py-6">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex flex-wrap gap-3 justify-center" id="category-filter"></div>
    <script>
    (function(){
      const container=document.getElementById('category-filter');
      if(!container) return;
      async function load(){
        try{const res=await fetch('/api/blog/categories');if(!res.ok) throw new Error();const cats=await res.json();const parts=window.location.pathname.split('/');const currentName=parts.indexOf('category')>-1?decodeURIComponent(parts[parts.indexOf('category')+1]):'';container.innerHTML=cats.map(c=>`<a href='/category/${encodeURIComponent(c.name)}' class='px-4 py-2 rounded-full text-sm font-medium ${c.name===currentName?'bg-blue-600 text-white':'bg-white text-gray-700 hover:bg-gray-100 transition-colors'}'>${c.name}</a>`).join('');}
        catch(e){console.error(e);} }
      document.addEventListener('DOMContentLoaded',load);
    })();
    </script>
  </div>
</div>

<!-- Main Content -->
<main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
  <!-- Featured Category Story -->
  <div id="category-featured" class="mb-12"></div>

  <!-- E-commerce Stories Grid -->
  <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8" id="category-grid">
    <div id="category-loading" class="col-span-full flex justify-center py-12"><div class="inline-block animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500"></div></div>
    <div id="category-error" class="col-span-full text-center py-12 text-red-500 hidden">Failed to load stories.</div>
    <!-- Dynamic posts will be injected via JS -->
  </div>

  <!-- E-commerce Insights Section -->
  <div class="mt-16 bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl p-8 border border-blue-200">
    <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">E-commerce Industry Insights</h2>
    <div class="grid md:grid-cols-2 gap-8">
      <div>
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Key Success Factors</h3>
        <ul class="space-y-3 text-gray-700">
          <li class="flex items-start gap-2">
            <span class="text-blue-600 mt-1">•</span>
            <span><strong>Customer Experience:</strong> Seamless shopping experience from discovery to delivery</span>
          </li>
          <li class="flex items-start gap-2">
            <span class="text-blue-600 mt-1">•</span>
            <span><strong>Data-Driven Decisions:</strong> Using analytics to optimize conversion and retention</span>
          </li>
          <li class="flex items-start gap-2">
            <span class="text-blue-600 mt-1">•</span>
            <span><strong>Supply Chain Innovation:</strong> Efficient logistics and fulfillment operations</span>
          </li>
          <li class="flex items-start gap-2">
            <span class="text-blue-600 mt-1">•</span>
            <span><strong>Brand Building:</strong> Creating strong brand identity and customer loyalty</span>
          </li>
        </ul>
      </div>
      <div>
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Market Trends</h3>
        <ul class="space-y-3 text-gray-700">
          <li class="flex items-start gap-2">
            <span class="text-purple-600 mt-1">•</span>
            <span><strong>Mobile Commerce:</strong> 70% of e-commerce traffic now comes from mobile devices</span>
          </li>
          <li class="flex items-start gap-2">
            <span class="text-purple-600 mt-1">•</span>
            <span><strong>Social Commerce:</strong> Integration of shopping with social media platforms</span>
          </li>
          <li class="flex items-start gap-2">
            <span class="text-purple-600 mt-1">•</span>
            <span><strong>Sustainability:</strong> Growing demand for eco-friendly products and practices</span>
          </li>
          <li class="flex items-start gap-2">
            <span class="text-purple-600 mt-1">•</span>
            <span><strong>Personalization:</strong> AI-driven product recommendations and customization</span>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div class="flex justify-center mt-12">
    <nav class="flex items-center gap-2">
      <button
        class="px-4 py-2 text-gray-600 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">Previous</button>
      <button class="px-4 py-2 text-white bg-blue-600 border border-blue-600 rounded-lg">1</button>
      <button
        class="px-4 py-2 text-gray-600 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">2</button>
      <button
        class="px-4 py-2 text-gray-600 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">3</button>
      <button
        class="px-4 py-2 text-gray-600 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">4</button>
      <button
        class="px-4 py-2 text-gray-600 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">Next</button>
    </nav>
  </div>
</main>

<script>
(function(){
  const grid=document.getElementById('category-grid');
  const loadEl=document.getElementById('category-loading');
  const errEl=document.getElementById('category-error');
  const featuredContainer=document.getElementById('category-featured');
  const catNameEls=document.querySelectorAll('[data-category-name]');
  const fallbackImg="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200' viewBox='0 0 400 200'%3E%3Crect width='400' height='200' fill='%23f3f4f6'/%3E%3Ctext x='200' y='100' text-anchor='middle' font-family='Arial' font-size='16' fill='%23666'%3ENo Image%3C/text%3E%3C/svg%3E";

  // Build article card HTML
  function card(p){
    return `<article class='bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-shadow duration-300'>
      <a href='/post/${p.slug}' class='block relative'>
        <img src='${p.featured_image||fallbackImg}' alt='${p.title}' class='w-full h-48 object-cover' onerror="this.src='${fallbackImg}'">
        <div class='absolute top-4 left-4'>
          <span class='bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium'>${p.category||''}</span>
        </div>
      </a>
      <div class='p-6'>
        <h3 class='text-xl font-bold text-gray-900 mb-3 line-clamp-2'>${p.title}</h3>
        <p class='text-gray-600 mb-4 line-clamp-3'>${p.excerpt||''}</p>
        <div class='flex items-center gap-3 mb-4'>
          <img src='${p.author_avatar||'/images/default-avatar.png'}' class='w-8 h-8 rounded-full'>
          <div>
            <div class='font-semibold text-gray-900 text-sm'>${p.author||''}</div>
          </div>
        </div>
        <div class='flex justify-between items-center text-sm text-gray-600'>
          <span>${p.read_time||5} min read</span>
          <span>${new Date(p.published_at).toLocaleDateString('id-ID',{month:'short',day:'numeric',year:'numeric'})}</span>
        </div>
      </div>
    </article>`;
  }

  function getCategoryFromURL(){
    const parts=window.location.pathname.split('/');
    const idx=parts.indexOf('category');
    if(idx>-1 && idx+1<parts.length){return decodeURIComponent(parts[idx+1]);}
    return '';
  }

  // Build featured markup
  function featuredMarkup(p){return `<div class='bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl p-8 border border-blue-200'><div class='flex items-center gap-3 mb-4'><span class='bg-blue-600 text-white px-3 py-1 rounded-full text-sm font-medium'>Featured</span><span class='bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium'>${p.category||''}</span></div><div class='grid md:grid-cols-2 gap-8 items-center'><div><h2 class='text-3xl font-bold text-gray-900 mb-4'>${p.title}</h2><p class='text-gray-600 mb-6'>${p.excerpt||''}</p><div class='flex items-center gap-4 mb-6'><img src='${p.author_avatar||'/images/default-avatar.png'}' class='w-10 h-10 rounded-full'><div><div class='font-semibold text-gray-900'>${p.author||''}</div><div class='text-sm text-gray-600'>${p.read_time||5} min read • ${new Date(p.published_at).toLocaleDateString('id-ID',{month:'short',day:'numeric',year:'numeric'})}</div></div></div></div><div><img src='${p.featured_image||fallbackImg}' alt='${p.title}' class='w-full h-64 object-cover rounded-xl' onerror="this.src='${fallbackImg}'"></div></div></div>`;}

  async function load(){
    const start=performance.now();
    const categoryName=getCategoryFromURL();
    if(!categoryName){loadEl.classList.add('hidden');errEl.classList.remove('hidden');errEl.textContent='Invalid category.';return;}
    try{
      const res=await fetch(`/api/blog/posts/category/${encodeURIComponent(categoryName)}?limit=30`);
      if(!res.ok) throw new Error();
      let posts=await res.json();const elapsed=((performance.now()-start)/1000).toFixed(2)+' seconds';
      if(posts && posts.length){featuredContainer.innerHTML=featuredMarkup(posts[0]);posts=posts.slice(1);}else{featuredContainer.classList.add('hidden');}
      // Clear existing static content
      grid.innerHTML='';
      if(posts && posts.length){
        grid.innerHTML=posts.map(card).join('');
      }else{
        grid.innerHTML=`<div class='col-span-full text-center py-12 text-gray-500'>No stories found.</div>`;
      }
    }catch(e){
      console.error(e);
      errEl.classList.remove('hidden');
    }finally{
      loadEl.classList.add('hidden');
    }
  }
  function setCatName(){const n=getCategoryFromURL();catNameEls.forEach(el=>el.textContent=n);}

  document.addEventListener('DOMContentLoaded',()=>{setCatName();load();});
})();
</script>