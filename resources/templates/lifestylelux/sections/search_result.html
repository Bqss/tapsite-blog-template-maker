<!-- Search Header -->
<section class="bg-white py-16 border-b elegant-border">
  <div class="max-w-4xl mx-auto px-4 lg:px-8 text-center">
    <h1 class="font-serif text-4xl lg:text-6xl font-light text-luxury-dark mb-6">Discover Luxury</h1>
    <p id="search-stats" class="text-lg text-gray-600 mb-4 hidden"></p>
    <p class="text-xl text-gray-600 mb-8 max-w-2xl mx-auto">
      Search through our curated collection of luxury lifestyle content, from haute couture to fine dining experiences
    </p>
    <div class="w-24 h-px bg-luxury-gold mx-auto"></div>
  </div>
</section>

<!-- Search Interface -->
<section class="py-12 bg-white border-b elegant-border">
  <div class="max-w-4xl mx-auto px-4 lg:px-8">
    <!-- Main Search Bar -->
    <div class="relative mb-8">
      <div class="relative">
        <input type="text" id="main-search" placeholder="Search for luxury lifestyle content..." value="haute couture"
          class="w-full pl-12 pr-20 py-4 text-lg elegant-border rounded-full bg-luxury-light focus:outline-none focus:ring-2 focus:ring-luxury-gold focus:bg-white transition-all">
        <svg class="w-6 h-6 absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400" fill="none"
          stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
        <button
          class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-luxury-gold text-white px-6 py-2 rounded-full font-medium hover:bg-opacity-90 transition-all">
          Search
        </button>
      </div>

      <!-- Autocomplete Dropdown -->
      <div class="absolute top-full left-0 right-0 mt-2 autocomplete-dropdown hidden" id="autocomplete">
        <div class="p-4">
          <div class="text-xs text-gray-500 mb-2">Popular searches</div>
          <div class="space-y-2">
            <div class="flex items-center space-x-3 p-2 hover:bg-luxury-light rounded cursor-pointer">
              <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
              </svg>
              <span class="text-sm">haute couture spring collection</span>
            </div>
            <div class="flex items-center space-x-3 p-2 hover:bg-luxury-light rounded cursor-pointer">
              <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
              </svg>
              <span class="text-sm">luxury interior design</span>
            </div>
            <div class="flex items-center space-x-3 p-2 hover:bg-luxury-light rounded cursor-pointer">
              <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
              </svg>
              <span class="text-sm">michelin starred restaurants</span>
            </div>
            <div class="flex items-center space-x-3 p-2 hover:bg-luxury-light rounded cursor-pointer">
              <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
              </svg>
              <span class="text-sm">luxury wellness retreats</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Search Tips -->
    <div class="bg-luxury-light rounded-lg p-6 mb-8">
      <h3 class="font-serif text-lg font-medium text-luxury-dark mb-3">Search Tips</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600">
        <div>
          <span class="font-medium">Use quotes</span> for exact phrases: <code
            class="bg-white px-2 py-1 rounded">"luxury travel"</code>
        </div>
        <div>
          <span class="font-medium">Exclude terms</span> with minus: <code
            class="bg-white px-2 py-1 rounded">fashion -vintage</code>
        </div>
        <div>
          <span class="font-medium">Search by author</span>: <code
            class="bg-white px-2 py-1 rounded">author:Victoria Sterling</code>
        </div>
        <div>
          <span class="font-medium">Filter by category</span>: <code
            class="bg-white px-2 py-1 rounded">category:fashion</code>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Search Results -->
<section class="py-12">
  <div class="max-w-7xl mx-auto px-4 lg:px-8">
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
      <!-- Filters Sidebar -->
      <aside class="lg:col-span-1">
        <div class="bg-white rounded-lg elegant-border p-6 sticky top-24">
          <h3 class="font-serif text-lg font-medium text-luxury-dark mb-4">Refine Search</h3>

          <!-- Categories -->
          <div class="mb-6">
            <h4 class="font-medium text-luxury-dark mb-3">Categories</h4>
            <div class="space-y-2">
              <label class="flex items-center">
                <input type="checkbox" checked class="text-luxury-gold rounded focus:ring-luxury-gold">
                <span class="ml-2 text-sm">Fashion (18)</span>
              </label>
              <label class="flex items-center">
                <input type="checkbox" class="text-luxury-gold rounded focus:ring-luxury-gold">
                <span class="ml-2 text-sm">Interior Design (12)</span>
              </label>
              <label class="flex items-center">
                <input type="checkbox" class="text-luxury-gold rounded focus:ring-luxury-gold">
                <span class="ml-2 text-sm">Travel (22)</span>
              </label>
              <label class="flex items-center">
                <input type="checkbox" class="text-luxury-gold rounded focus:ring-luxury-gold">
                <span class="ml-2 text-sm">Dining (8)</span>
              </label>
              <label class="flex items-center">
                <input type="checkbox" class="text-luxury-gold rounded focus:ring-luxury-gold">
                <span class="ml-2 text-sm">Wellness (15)</span>
              </label>
              <label class="flex items-center">
                <input type="checkbox" class="text-luxury-gold rounded focus:ring-luxury-gold">
                <span class="ml-2 text-sm">Accessories (9)</span>
              </label>
            </div>
          </div>

          <!-- Date Range -->
          <div class="mb-6">
            <h4 class="font-medium text-luxury-dark mb-3">Date Range</h4>
            <select
              class="w-full elegant-border rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-luxury-gold">
              <option>Any time</option>
              <option>Last week</option>
              <option>Last month</option>
              <option>Last year</option>
            </select>
          </div>

          <!-- Read Time -->
          <div class="mb-6">
            <h4 class="font-medium text-luxury-dark mb-3">Read Time</h4>
            <div class="space-y-2">
              <label class="flex items-center">
                <input type="checkbox" class="text-luxury-gold rounded focus:ring-luxury-gold">
                <span class="ml-2 text-sm">Quick read (< 5 min)</span>
              </label>
              <label class="flex items-center">
                <input type="checkbox" class="text-luxury-gold rounded focus:ring-luxury-gold">
                <span class="ml-2 text-sm">Medium read (5-10 min)</span>
              </label>
              <label class="flex items-center">
                <input type="checkbox" class="text-luxury-gold rounded focus:ring-luxury-gold">
                <span class="ml-2 text-sm">Long read (10+ min)</span>
              </label>
            </div>
          </div>

          <!-- Popular Tags -->
          <div>
            <h4 class="font-medium text-luxury-dark mb-3">Popular Tags</h4>
            <div class="flex flex-wrap gap-2">
              <span class="bg-luxury-gold text-white px-3 py-1 rounded-full text-xs cursor-pointer">luxury</span>
              <span
                class="bg-luxury-light text-luxury-dark px-3 py-1 rounded-full text-xs elegant-border cursor-pointer hover:bg-luxury-gold hover:text-white transition-all">elegance</span>
              <span
                class="bg-luxury-light text-luxury-dark px-3 py-1 rounded-full text-xs elegant-border cursor-pointer hover:bg-luxury-gold hover:text-white transition-all">premium</span>
              <span
                class="bg-luxury-light text-luxury-dark px-3 py-1 rounded-full text-xs elegant-border cursor-pointer hover:bg-luxury-gold hover:text-white transition-all">exclusive</span>
              <span
                class="bg-luxury-light text-luxury-dark px-3 py-1 rounded-full text-xs elegant-border cursor-pointer hover:bg-luxury-gold hover:text-white transition-all">sophisticated</span>
            </div>
          </div>
        </div>
      </aside>

      <!-- Results -->
      <main class="lg:col-span-3">
        <!-- Results Header -->
        <div class="flex justify-between items-center mb-8">
          <div>
            <h2 class="font-serif text-2xl font-medium text-luxury-dark mb-2">
              Search Results for "<span class="search-highlight">haute couture</span>"
            </h2>
            <p class="text-gray-600">Found 24 articles in 0.12 seconds</p>
          </div>
          <div class="flex items-center space-x-4">
            <span class="text-sm text-gray-600">Sort by:</span>
            <select
              class="elegant-border rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-luxury-gold">
              <option>Relevance</option>
              <option>Latest</option>
              <option>Most Popular</option>
              <option>Most Read</option>
            </select>
          </div>
        </div>

        <!-- Search Results Grid -->
        <div id="search-grid" class="space-y-8"></div>
        <div class="flex justify-center mt-12">
          <button id="search-loadmore" class="bg-luxury-gold text-white px-6 py-3 rounded-full font-medium hover:bg-opacity-90 transition-all hidden">Load More</button>
        </div>
      </main>
    </div>
  </div>
</section>

<script>
(function () {
  const grid = document.getElementById('search-grid');
  const statsEl = document.getElementById('search-stats');
  const loadBtn = document.getElementById('search-loadmore');
  if (!grid) return;

  let page = 1;
  const limit = 10;

  const parts = window.location.pathname.split('/');
  const idx = parts.indexOf('search');
  const query = idx !== -1 ? decodeURIComponent(parts[idx + 1] || '') : '';

  document.getElementById('main-search').value = query;

  function fetchResults() {
    loadBtn && (loadBtn.disabled = true);
    fetch(`/api/blog/posts/search/${encodeURIComponent(query)}?page=${page}&limit=${limit}`)
      .then(r => r.json())
      .then(res => {
        const results = Array.isArray(res) ? res : (res.posts || res || []);
        if (page === 1) {
          grid.innerHTML = '';
          if (statsEl) {
            statsEl.classList.remove('hidden');
            statsEl.textContent = `Found ${results.length} results for "${query}"`;
          }
        }
        results.forEach(a => grid.insertAdjacentHTML('beforeend', createResultHTML(a)));
        if (results.length < limit) {
          loadBtn && (loadBtn.style.display = 'none');
        } else {
          loadBtn && (loadBtn.style.display = 'inline-block');
        }
        page += 1;
        loadBtn && (loadBtn.disabled = false);
      })
      .catch(err => {
        console.error(err);
        loadBtn && (loadBtn.disabled = false);
      });
  }

  function createResultHTML(a) {
    const img = a.featured_image || '';
    const cat = a.category || 'Luxury';
    const read = a.read_time || 5;
    const date = new Date(a.published_at || Date.now()).toLocaleDateString(undefined,{year:'numeric',month:'long',day:'numeric'});
    return `
    <article class="luxury-hover cursor-pointer">
      <div class="bg-white rounded-lg elegant-border overflow-hidden">
        <div class="md:flex">
          <div class="md:w-1/3 flex-shrink-0">${img ? `<img src="${img}" alt="${a.title}" class="w-full h-48 md:h-full object-cover">` : ''}</div>
          <div class="p-6 md:w-2/3">
            <div class="flex items-center space-x-2 mb-3"><span class="bg-luxury-gold text-white px-3 py-1 rounded-full text-xs font-medium">${cat}</span><span class="text-xs text-gray-500">${read} min read</span></div>
            <h3 class="font-serif text-xl font-medium text-luxury-dark mb-3 hover:text-luxury-gold transition-colors">${a.title}</h3>
            <p class="text-gray-600 text-sm mb-4 line-clamp-3">${a.excerpt || ''}</p>
            <div class="flex items-center justify-between text-xs text-gray-500"><span>By ${a.author || 'Editor'}</span><span>${date}</span></div>
          </div>
        </div>
      </div>
    </article>`;
  }

  loadBtn && loadBtn.addEventListener('click', fetchResults);

  // initial load
  fetchResults();
})();
</script>