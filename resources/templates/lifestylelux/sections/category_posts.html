<!-- Category Header -->
<section class="relative h-64 lg:h-80 overflow-hidden">
  <img src="https://images.unsplash.com/photo-1515372039744-b8f02a3ae446?w=1920&h=800&fit=crop" alt="Fashion Category"
    class="w-full h-full object-cover">
  <div class="absolute inset-0 featured-overlay flex items-center justify-center">
    <div class="text-center text-white px-4">
      <h1 id="category-title" class="font-serif text-4xl lg:text-6xl font-light mb-4">Fashion</h1>
      <p id="category-desc" class="text-xl font-light opacity-90 mb-4">Haute couture, luxury brands, and style inspiration</p>
      <div class="w-24 h-px bg-luxury-gold mx-auto"></div>
      <p id="category-count" class="text-sm font-light mt-4 opacity-80">0 curated articles</p>
    </div>
  </div>
</section>

<!-- Breadcrumb -->
<div class="max-w-7xl mx-auto px-4 lg:px-8 py-4">
  <nav class="text-sm">
    <a href="#" class="text-gray-500 hover:text-luxury-gold transition-colors">Home</a>
    <span class="mx-2 text-gray-400">/</span>
    <span id="breadcrumb-current" class="text-luxury-gold font-medium">Fashion</span>
  </nav>
</div>

<!-- Featured Article -->
<section class="max-w-7xl mx-auto px-4 lg:px-8 py-8">
  <div class="mb-8">
    <h2 class="font-serif text-2xl lg:text-3xl font-light text-luxury-dark mb-2">Featured This Week</h2>
    <div class="w-16 h-px bg-luxury-gold"></div>
  </div>

  <div id="featured-container" class="min-h-[200px] flex items-center justify-center py-12 text-gray-500">Loading featured...</div>
</section>

<!-- Filter & Sort -->
<section class="max-w-7xl mx-auto px-4 lg:px-8 py-4">
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8">
    <div class="flex flex-wrap gap-2">
      <button class="bg-luxury-gold text-white px-4 py-2 rounded-full text-sm font-medium">All</button>
      <button
        class="bg-white text-luxury-dark px-4 py-2 rounded-full text-sm font-medium elegant-border hover:bg-luxury-gold hover:text-white transition-all">Haute
        Couture</button>
      <button
        class="bg-white text-luxury-dark px-4 py-2 rounded-full text-sm font-medium elegant-border hover:bg-luxury-gold hover:text-white transition-all">Luxury
        Brands</button>
      <button
        class="bg-white text-luxury-dark px-4 py-2 rounded-full text-sm font-medium elegant-border hover:bg-luxury-gold hover:text-white transition-all">Sustainable
        Fashion</button>
      <button
        class="bg-white text-luxury-dark px-4 py-2 rounded-full text-sm font-medium elegant-border hover:bg-luxury-gold hover:text-white transition-all">Accessories</button>
    </div>

    <div class="flex items-center space-x-4">
      <span class="text-sm text-gray-600">Sort by:</span>
      <select
        class="bg-white elegant-border rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-luxury-gold">
        <option>Latest</option>
        <option>Most Popular</option>
        <option>Most Read</option>
        <option>Trending</option>
      </select>
    </div>
  </div>
</section>

<!-- Articles Grid -->
<section class="max-w-7xl mx-auto px-4 lg:px-8 pb-16">
  <div id="category-grid" class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    <!-- dynamic cards will be inserted here -->
  </div>

  <!-- Load More -->
  <div class="text-center mt-12">
    <button
      class="bg-luxury-gold text-white px-8 py-3 rounded-full font-medium hover:bg-opacity-90 transition-all duration-300 hover:shadow-lg">
      Load More Articles
    </button>
  </div>
</section>

<!-- Related Categories -->
<section class="bg-white py-16 border-t elegant-border">
  <div class="max-w-7xl mx-auto px-4 lg:px-8">
    <div class="text-center mb-12">
      <h2 class="font-serif text-3xl font-light text-luxury-dark mb-4">Explore More Categories</h2>
      <div class="w-16 h-px bg-luxury-gold mx-auto"></div>
    </div>

    <div class="grid grid-cols-2 lg:grid-cols-5 gap-6">
      <a href="#" class="group text-center">
        <div class="relative overflow-hidden rounded-lg elegant-border mb-3">
          <img src="https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=200&h=200&fit=crop"
            alt="Interior Design"
            class="w-full h-32 object-cover group-hover:scale-105 transition-transform duration-300">
        </div>
        <h3 class="font-serif font-medium text-luxury-dark group-hover:text-luxury-gold transition-colors">Interior
          Design</h3>
        <p class="text-xs text-gray-500">12 articles</p>
      </a>

      <a href="#" class="group text-center">
        <div class="relative overflow-hidden rounded-lg elegant-border mb-3">
          <img src="https://images.unsplash.com/photo-1436491865332-7a61a109cc05?w=200&h=200&fit=crop" alt="Travel"
            class="w-full h-32 object-cover group-hover:scale-105 transition-transform duration-300">
        </div>
        <h3 class="font-serif font-medium text-luxury-dark group-hover:text-luxury-gold transition-colors">Travel</h3>
        <p class="text-xs text-gray-500">22 articles</p>
      </a>

      <a href="#" class="group text-center">
        <div class="relative overflow-hidden rounded-lg elegant-border mb-3">
          <img src="https://images.unsplash.com/photo-1551218808-94e220e084d2?w=200&h=200&fit=crop" alt="Dining"
            class="w-full h-32 object-cover group-hover:scale-105 transition-transform duration-300">
        </div>
        <h3 class="font-serif font-medium text-luxury-dark group-hover:text-luxury-gold transition-colors">Dining</h3>
        <p class="text-xs text-gray-500">8 articles</p>
      </a>

      <a href="#" class="group text-center">
        <div class="relative overflow-hidden rounded-lg elegant-border mb-3">
          <img src="https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=200&h=200&fit=crop" alt="Wellness"
            class="w-full h-32 object-cover group-hover:scale-105 transition-transform duration-300">
        </div>
        <h3 class="font-serif font-medium text-luxury-dark group-hover:text-luxury-gold transition-colors">Wellness</h3>
        <p class="text-xs text-gray-500">15 articles</p>
      </a>

      <a href="#" class="group text-center">
        <div class="relative overflow-hidden rounded-lg elegant-border mb-3">
          <img src="https://images.unsplash.com/photo-1523170335258-f5c54a6b4a2b?w=200&h=200&fit=crop" alt="Accessories"
            class="w-full h-32 object-cover group-hover:scale-105 transition-transform duration-300">
        </div>
        <h3 class="font-serif font-medium text-luxury-dark group-hover:text-luxury-gold transition-colors">Accessories
        </h3>
        <p class="text-xs text-gray-500">9 articles</p>
      </a>
    </div>
  </div>
</section>

<script>
(function () {
  const titleEl = document.getElementById('category-title');
  const descEl = document.getElementById('category-desc');
  const countEl = document.getElementById('category-count');
  const crumbEl = document.getElementById('breadcrumb-current');
  const featContainer = document.getElementById('featured-container');
  const grid = document.getElementById('category-grid');

  if (!grid || !featContainer) return;

  // clear any leftover static articles
  grid.innerHTML = '';

  const parts = window.location.pathname.split('/');
  const idx = parts.indexOf('category');
  const slug = idx !== -1 ? decodeURIComponent(parts[idx + 1] || '') : '';

  titleEl.textContent = slug.replace(/-/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
  crumbEl.textContent = titleEl.textContent;

  // fetch category data & posts
  Promise.all([
    fetch(`/api/blog/categories/${encodeURIComponent(slug)}`).then(r => r.json()).catch(() => null),
    fetch(`/api/blog/posts/category/${encodeURIComponent(slug)}?limit=20`).then(r => r.json()).catch(() => [])
  ]).then(([catInfo, posts]) => {
    if (catInfo && descEl) descEl.textContent = catInfo.description || '';
    if (countEl) countEl.textContent = `${posts.length} curated articles`;

    if (posts.length) {
      renderFeatured(posts[0]);
      posts.slice(1).forEach(p => grid.insertAdjacentHTML('beforeend', createCardHTML(p)));
    } else {
      featContainer.textContent = 'No articles yet.';
    }
  }).catch(err => {
    console.error(err);
    featContainer.textContent = 'Failed to load articles.';
  });

  function initials(name = '') { return name.split(' ').map(n=>n[0]).join('').toUpperCase().slice(0,2); }

  function renderFeatured(a) {
    featContainer.innerHTML = createFeaturedHTML(a);
  }

  function createFeaturedHTML(a) {
    const img = a.featured_image || '';
    const read = a.read_time || 5;
    const date = new Date(a.published_at || Date.now()).toLocaleDateString(undefined, {year:'numeric',month:'long',day:'numeric'});
    return `
    <article class="luxury-hover cursor-pointer group">
      <div class="magazine-layout bg-white rounded-lg elegant-border overflow-hidden">
        <div class="relative h-64 lg:h-80">
          ${img ? `<img src="${img}" alt="${a.title}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700">` : ''}
          <div class="absolute top-4 left-4"><span class="bg-luxury-gold text-white px-3 py-1 rounded-full text-xs font-medium">FEATURED</span></div>
        </div>
        <div class="p-8 flex flex-col justify-center">
          <div class="mb-4"><span class="text-luxury-gold text-sm font-medium">${a.category || ''}</span></div>
          <h3 class="font-serif text-2xl lg:text-3xl font-medium text-luxury-dark mb-4 group-hover:text-luxury-gold transition-colors">${a.title}</h3>
          <p class="text-gray-600 mb-6 leading-relaxed">${a.excerpt || ''}</p>
          <div class="flex items-center justify-between text-sm text-gray-500"><div class="flex items-center space-x-4"><span>By ${a.author || 'Editor'}</span><span>â€¢</span><span>${date}</span></div><span>${read} min read</span></div>
        </div>
      </div>
    </article>`;
  }

  function createCardHTML(a) {
    const img = a.featured_image || '';
    const cat = a.category || 'Luxury';
    const read = a.read_time || 5;
    return `
    <article class="luxury-hover cursor-pointer group">
      <div class="bg-white rounded-lg elegant-border overflow-hidden">
        <div class="relative h-48">
          ${img ? `<img src="${img}" alt="${a.title}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500">` : ''}
          <div class="absolute top-4 left-4"><span class="bg-luxury-gold text-white px-3 py-1 rounded-full text-xs font-medium">${cat}</span></div>
        </div>
        <div class="p-6">
          <div class="mb-3"><span class="text-luxury-gold text-sm font-medium">${cat.toUpperCase()}</span></div>
          <h3 class="font-serif text-xl font-medium text-luxury-dark mb-3 group-hover:text-luxury-gold transition-colors">${a.title}</h3>
          <p class="text-gray-600 text-sm mb-4 leading-relaxed line-clamp-3">${a.excerpt || ''}</p>
          <div class="flex items-center justify-between text-xs text-gray-500"><span>${a.author || 'Editor'}</span><span>${read} min read</span></div>
        </div>
      </div>
    </article>`;
  }
})();
</script>