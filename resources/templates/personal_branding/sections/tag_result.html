<main class="pt-[74px]">
  <!-- Tag Header Section -->
  <section class="py-16 bg-gradient-to-br from-slate-50 to-blue-50">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="text-center space-y-6">
              <div class="flex items-center justify-center space-x-2 text-sm text-slate-600">
                  <a href="#" class="hover:text-blue-600 transition-colors duration-200">Home</a>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            class="lucide lucide-chevron-right">
                      <path d="m9 18 6-6-6-6"></path>
                  </svg>
                  <a href="#" class="hover:text-blue-600 transition-colors duration-200">Blog</a>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            class="lucide lucide-chevron-right">
                      <path d="m9 18 6-6-6-6"></path>
                  </svg>
                  <span class="text-blue-600">Technology</span>
              </div>
              
              <div class="space-y-4">
                  <div class="inline-flex items-center space-x-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
              class="lucide lucide-tag w-6 h-6 text-blue-600">
                          <path d="M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z"></path>
                          <path d="M7 7h.01"></path>
                      </svg>
                      <span class="bg-blue-600 text-white px-4 py-2 rounded-full text-lg font-medium">Technology</span>
                  </div>
                  
                  <h1 class="text-4xl md:text-5xl font-bold text-slate-900">Technology Articles</h1>
          <p class="text-xl text-slate-600 max-w-3xl mx-auto">Exploring the latest trends, frameworks, and innovations
            in the world of technology and software development.</p>
                  
                  <div class="flex items-center justify-center space-x-6 text-sm text-slate-500">
                      <div class="flex items-center space-x-1">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="lucide lucide-file-text">
                              <path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"></path>
                              <path d="M14 2v4a2 2 0 0 0 2 2h4"></path>
                              <path d="M10 9H8"></path>
                              <path d="M16 13H8"></path>
                              <path d="M16 17H8"></path>
                          </svg>
                          <span>12 Articles</span>
                      </div>
                      <div class="flex items-center space-x-1">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="lucide lucide-clock">
                              <circle cx="12" cy="12" r="10"></circle>
                              <polyline points="12 6 12 12 16 14"></polyline>
                          </svg>
                          <span>~8 min avg read</span>
                      </div>
                  </div>
              </div>
          </div>
      </div>
  </section>

  <!-- Articles Grid Section -->
  <section class="py-20 bg-white">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <!-- States -->
      <div id="tag-loading" class="py-12 text-center">
        <div class="inline-block animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"></div>
        <p class="text-slate-500 mt-4">Loading posts...</p>
                      </div>
      <div id="tag-error" class="py-12 text-center hidden">
        <p class="text-red-500">Failed to load posts.</p>
                  </div>
      <div id="tag-empty" class="py-12 text-center hidden">
        <p class="text-slate-500">No posts for this tag.</p>
          </div>

      <div id="tag-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 hidden"></div>

          <!-- Pagination -->
      <div id="tag-pagination" class="flex justify-center mt-12 hidden"></div>
      </div>
  </section>
  <!-- Related Tags Section -->
  <section class="py-16 bg-slate-50">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="text-center mb-12">
              <h2 class="text-2xl md:text-3xl font-bold text-slate-900 mb-4">Explore More Topics</h2>
              <p class="text-lg text-slate-600">Discover articles on other interesting topics</p>
          </div>
      <!-- States -->
      <div id="topics-loading" class="flex justify-center py-8">
        <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
      </div>
      <div id="topics-error" class="text-center py-8 hidden">
        <p class="text-red-500">Failed to load topics.</p>
          </div>
      <div id="topics-empty" class="text-center py-8 hidden">
        <p class="text-slate-500">No topics available.</p>
      </div>
      <div id="topics-container" class="flex flex-wrap justify-center gap-4 hidden"></div>
      </div>
  </section>

  <!-- Newsletter Section -->
  <section class="py-16 bg-blue-600">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
          <div class="space-y-6">
              <h2 class="text-3xl md:text-4xl font-bold text-white">Stay Updated</h2>
              <p class="text-xl text-blue-100 max-w-2xl mx-auto">
                  Get the latest articles and insights delivered straight to your inbox. No spam, just quality content.
              </p>
              <div class="max-w-md mx-auto">
                  <div class="flex space-x-4">
            <input type="email" placeholder="Enter your email"
              class="flex-1 px-4 py-3 rounded-lg border-0 focus:ring-2 focus:ring-blue-300 focus:outline-none">
            <button
              class="bg-white text-blue-600 px-6 py-3 rounded-lg hover:bg-blue-50 transition-colors duration-200 font-medium">
                          Subscribe
                      </button>
                  </div>
                  <p class="text-sm text-blue-200 mt-3">Join 2,500+ developers who read our newsletter</p>
              </div>
          </div>
      </div>
  </section>
</main>

<script>
  (function () {
    const cont = document.getElementById('topics-container');
    const load = document.getElementById('topics-loading');
    const err = document.getElementById('topics-error');
    const empty = document.getElementById('topics-empty');

    function chip(t) {
      return `
        <a href="/tag/${t}" 
           class="bg-white text-slate-700 px-6 py-3 rounded-full hover:bg-blue-50 hover:text-blue-600 transition-all duration-200 shadow-sm hover:shadow-md border border-slate-200">
          <span class="flex items-center space-x-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none"
                 stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                 class="lucide lucide-tag">
              <path d="M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z"></path>
              <path d="M7 7h.01"></path>
            </svg>
            <span>${t}</span>

          </span>
        </a>`;
    }

    async function loadTopics() {
      try {
        const res = await fetch('/api/blog/tags?limit=20');
        if (!res.ok) throw new Error();

        const tags = await res.json();
        load.classList.add('hidden');

        if (!tags.length) {
          empty.classList.remove('hidden');
          return;
        }

        cont.innerHTML = tags.map(chip).join('');
        cont.classList.remove('hidden');
      } catch (e) {
        console.error(e);
        load.classList.add('hidden');
        err.classList.remove('hidden');
      }
    }

    document.addEventListener('DOMContentLoaded', loadTopics);
  })();
</script>
<script>
  (function () {
    const LIMIT = 9;
    let currentPage = 1, totalPages = 1;

    const loadEl = document.getElementById('tag-loading');
    const errEl = document.getElementById('tag-error');
    const emptyEl = document.getElementById('tag-empty');
    const gridEl = document.getElementById('tag-grid');
    const pagEl = document.getElementById('tag-pagination');

    const headerTag = document.querySelector('span.bg-blue-600');
    const headerTitle = document.querySelector('h1');
    const countSpan = document.querySelector('.lucide-file-text')?.parentElement?.querySelector('span');
    const breadcrumb = document.querySelectorAll('.text-blue-600')[1];

    const tagSlug = decodeURIComponent(window.location.pathname.split('/').pop() || '');
    const tagLabel = tagSlug.replace(/-/g, ' ').replace(/\b\w/g, c => c.toUpperCase());

    if (headerTag) headerTag.textContent = tagLabel;
    if (headerTitle) headerTitle.textContent = `${tagLabel} Articles`;
    if (breadcrumb) breadcrumb.textContent = tagLabel;

    const fallbackImg = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200' viewBox='0 0 400 200'%3E%3Crect width='400' height='200' fill='%23f3f4f6'/%3E%3Ctext x='200' y='100' text-anchor='middle' dy='0.3em' font-family='Arial' font-size='16' fill='%23666'%3ENo Image%3C/text%3E%3C/svg%3E";

    function formatDate(ts) {
      return new Date(ts).toLocaleDateString('id-ID', {
        month: 'short',
        day: 'numeric',
        year: 'numeric',
      });
    }

    function card(p) {
      const img = p.featured_image || fallbackImg;
      return `
          <article class="bg-white rounded-2xl shadow-sm hover:shadow-xl transition-all duration-300 overflow-hidden group cursor-pointer border border-slate-100">
            <a href="/post/${p.slug}" class="relative overflow-hidden block">
              <img src="${img}" alt="${p.title}" class="w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300" onerror="this.src='${fallbackImg}'">
              <div class="absolute top-4 left-4">
                <span class="bg-blue-600 text-white px-3 py-1 rounded-full text-sm font-medium">${tagLabel}</span>
              </div>
            </a>
            <div class="p-6 space-y-4">
              <div class="flex items-center space-x-4 text-sm text-slate-500">
                <div class="flex items-center space-x-1">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" stroke="currentColor"
                       stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar">
                    <path d="M8 2v4"></path>
                    <path d="M16 2v4"></path>
                    <rect width="18" height="18" x="3" y="4" rx="2"></rect>
                    <path d="M3 10h18"></path>
                  </svg>
                  <span>${formatDate(p.published_at || Date.now())}</span>
                </div>
                <div class="flex items-center space-x-1">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" stroke="currentColor"
                       stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clock">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                  </svg>
                  <span>${p.read_time || 5} min read</span>
                </div>
              </div>
              <h3 class="text-xl font-bold text-slate-900 group-hover:text-blue-600 transition-colors duration-200 line-clamp-2">${p.title}</h3>
              <p class="text-slate-600 line-clamp-3">${p.excerpt || ''}</p>
              <div class="flex items-center text-blue-600 font-medium group-hover:text-blue-700 transition-colors duration-200">
                <span>Read more</span>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" stroke="currentColor"
                     stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-right ml-2 group-hover:translate-x-1 transition-transform duration-200">
                  <path d="M5 12h14"></path>
                  <path d="m12 5 7 7-7 7"></path>
                </svg>
              </div>
            </div>
          </article>`;
    }

    function renderPagination() {
      if (totalPages <= 1) {
        pagEl.classList.add('hidden');
        return;
      }

      let html = `<button ${currentPage === 1 ? 'disabled' : ''} data-page="prev" class="px-3 py-2 text-slate-500 hover:text-blue-600 disabled:opacity-40">&laquo;</button>`;

      for (let i = 1; i <= totalPages; i++) {
        html += `<button data-page="${i}" class="px-3 py-2 ${i === currentPage ? 'bg-blue-600 text-white' : 'text-slate-500 hover:text-blue-600'} rounded">${i}</button>`;
      }

      html += `<button ${currentPage === totalPages ? 'disabled' : ''} data-page="next" class="px-3 py-2 text-slate-500 hover:text-blue-600 disabled:opacity-40">&raquo;</button>`;

      pagEl.innerHTML = html;
      pagEl.classList.remove('hidden');

      pagEl.querySelectorAll('button').forEach(b => {
        b.addEventListener('click', e => {
          const v = e.currentTarget.dataset.page;
          if (v === 'prev') loadPosts(currentPage - 1);
          else if (v === 'next') loadPosts(currentPage + 1);
          else loadPosts(parseInt(v));
        });
      });
    }

    async function loadPosts(page = 1) {
      currentPage = page;
      loadEl.classList.remove('hidden');
      errEl.classList.add('hidden');
      emptyEl.classList.add('hidden');
      gridEl.classList.add('hidden');

      try {
        const res = await fetch(`/api/blog/posts/tag/${encodeURIComponent(tagSlug)}?limit=${LIMIT}&page=${page}`);
        if (!res.ok) throw new Error();

        const data = await res.json();
        const posts = data || [];

        totalPages = data.pagination ? data.pagination.total_pages : 1;
        if (countSpan) countSpan.textContent = `${data.pagination?.total || posts.length} Articles`;

        if (!posts.length) {
          emptyEl.classList.remove('hidden');
          renderPagination();
          return;
        }

        gridEl.innerHTML = posts.map(card).join('');
        gridEl.classList.remove('hidden');
        renderPagination();
      } catch (e) {
        console.error(e);
        errEl.classList.remove('hidden');
      } finally {
        loadEl.classList.add('hidden');
      }
    }

    document.addEventListener('DOMContentLoaded', () => loadPosts());
  })();
</script>